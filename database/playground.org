#+PROPERTY: header-args:sql    :exports both
#+PROPERTY: header-args:sql+    :engine postgresql
#+PROPERTY: header-args:sql+    :dbhost localhost
#+PROPERTY: header-args:sql+    :dbuser akvo
#+PROPERTY: header-args:sql+    :dbpassword password
#+PROPERTY: header-args:sql+    :database agriconnect
#+PROPERTY: header-args :tangle data-model.sql
#+STARTUP: showall

#+NAME: Schema
#+begin_src sql
\d
#+end_src

#+RESULTS: Schema
| List of relations |                  |          |       |
|-------------------+------------------+----------+-------|
| Schema            | Name             | Type     | Owner |
| public            | alembic_version  | table    | akvo  |
| public            | customers        | table    | akvo  |
| public            | customers_id_seq | sequence | akvo  |
| public            | messages         | table    | akvo  |
| public            | messages_id_seq  | sequence | akvo  |
| public            | users            | table    | akvo  |
| public            | users_id_seq     | sequence | akvo  |

#+NAME: Column List
#+begin_src sql
SELECT
    ordinal_position as pos,
    table_name,
    column_name,
    is_nullable,
    data_type,
    character_maximum_length as len
FROM   information_schema.columns
WHERE  table_name IN (
    'users',
    'customers',
    'messages'
)
ORDER  BY table_name, ordinal_position;
#+end_src

#+RESULTS: Column List
| pos | table_name | column_name           | is_nullable | data_type                | len |
|-----+------------+-----------------------+-------------+--------------------------+-----|
|   1 | customers  | id                    | NO          | integer                  |     |
|   2 | customers  | phone_number          | NO          | character varying        |     |
|   3 | customers  | full_name             | YES         | character varying        |     |
|   4 | customers  | language              | YES         | USER-DEFINED             |     |
|   5 | customers  | created_at            | YES         | timestamp with time zone |     |
|   6 | customers  | updated_at            | YES         | timestamp with time zone |     |
|   1 | messages   | id                    | NO          | integer                  |     |
|   2 | messages   | message_sid           | NO          | character varying        |     |
|   3 | messages   | customer_id           | NO          | integer                  |     |
|   4 | messages   | user_id               | YES         | integer                  |     |
|   5 | messages   | body                  | NO          | text                     |     |
|   6 | messages   | from_source           | NO          | integer                  |     |
|   7 | messages   | created_at            | YES         | timestamp with time zone |     |
|   1 | users      | id                    | NO          | integer                  |     |
|   2 | users      | email                 | NO          | character varying        |     |
|   3 | users      | phone_number          | NO          | character varying        |     |
|   4 | users      | hashed_password       | YES         | character varying        |     |
|   5 | users      | user_type             | NO          | USER-DEFINED             |     |
|   6 | users      | full_name             | NO          | character varying        |     |
|   8 | users      | created_at            | YES         | timestamp with time zone |     |
|   9 | users      | updated_at            | YES         | timestamp with time zone |     |
|  10 | users      | invitation_token      | YES         | character varying        |     |
|  11 | users      | invitation_sent_at    | YES         | timestamp with time zone |     |
|  12 | users      | invitation_expires_at | YES         | timestamp with time zone |     |
|  13 | users      | password_set_at       | YES         | timestamp with time zone |     |
|  14 | users      | is_active             | NO          | boolean                  |     |

#+NAME: Customer Message
#+begin_src sql
SELECT m.body, c.phone_number, c.created_at
FROM messages m
LEFT JOIN customers c
ON m.customer_id = c.id;
#+end_src

#+RESULTS: Customer Message
| body  |   phone_number | created_at                   |
|-------+----------------+------------------------------|
| Hello | +6285743333004 | 2025-09-11 08:40:21.53049+00 |

#+NAME: Delete Customer
#+begin_src sql
TRUNCATE TABLE messages;
TRUNCATE TABLE customers;
#+end_src

#+RESULTS: Delete Customer
| TRUNCATE TABLE |
|----------------|
